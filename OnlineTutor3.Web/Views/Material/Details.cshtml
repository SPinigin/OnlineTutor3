@model OnlineTutor3.Domain.Entities.Material
@{
    ViewData["Title"] = "Детали материала";
    var assignmentTitle = ViewBag.AssignmentTitle as string;
}

<div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
        <div class="card shadow modern-card">
            <div class="card-header auth-card-header py-2">
                <h5 class="mb-0 d-flex align-items-center">
                    @switch (Model.Type)
                    {
                        case MaterialType.Document:
                            <i class="fas fa-file-alt me-2 nav-link-icon-danger"></i>
                            break;
                        case MaterialType.Presentation:
                            <i class="fas fa-file-powerpoint me-2 nav-link-icon-yellow"></i>
                            break;
                        case MaterialType.Image:
                            <i class="fas fa-file-image me-2 nav-link-icon"></i>
                            break;
                        case MaterialType.Audio:
                            <i class="fas fa-file-audio me-2 nav-link-icon-green"></i>
                            break;
                        case MaterialType.Video:
                            <i class="fas fa-file-video me-2 nav-link-icon-blue"></i>
                            break;
                        default:
                            <i class="fas fa-file me-2 nav-link-icon"></i>
                            break;
                    }
                    <span class="text-truncate">@Model.Title</span>
                </h5>
            </div>
            <div class="card-body auth-card-body py-3">
                <div class="row g-2 mb-3">
                    <div class="col-12 col-sm-6">
                        <div class="small text-muted-modern">Тип</div>
                        <div><span class="badge badge-modern-secondary">@GetMaterialTypeDisplayName(Model.Type)</span></div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="small text-muted-modern">Статус</div>
                        <div>
                            @if (Model.IsActive)
                            {
                                <span class="badge badge-modern-success">Активен</span>
                            }
                            else
                            {
                                <span class="badge badge-modern-secondary">Неактивен</span>
                            }
                        </div>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <div class="mb-3">
                        <div class="small text-muted-modern mb-1">Описание</div>
                        <div class="text-dark-modern">@Model.Description</div>
                    </div>
                }

                <div class="row g-2 mb-3">
                    <div class="col-12 col-sm-6">
                        <div class="small text-muted-modern">Файл</div>
                        <div class="text-dark-modern text-truncate" title="@Model.FileName">@Model.FileName</div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="small text-muted-modern">Размер</div>
                        <div class="text-dark-modern">@FormatFileSize(Model.FileSize)</div>
                    </div>
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-12 col-sm-6">
                        <div class="small text-muted-modern">Дата загрузки</div>
                        <div class="text-dark-modern">@Model.UploadedAt.ToString("dd.MM.yyyy HH:mm")</div>
                    </div>
                    @if (Model.AssignmentId.HasValue)
                    {
                        <div class="col-12 col-sm-6">
                            <div class="small text-muted-modern">Задание</div>
                            <div>
                                @if (!string.IsNullOrEmpty(assignmentTitle))
                                {
                                    <span class="badge badge-modern-primary">@assignmentTitle</span>
                                }
                                else
                                {
                                    <span class="badge badge-modern-primary">Задание #@Model.AssignmentId</span>
                                }
                            </div>
                        </div>
                    }
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                    <a asp-action="Download" asp-route-id="@Model.Id" class="btn btn-modern-success btn-sm">
                        <i class="fas fa-download"></i> <span class="d-none d-sm-inline">Скачать</span>
                    </a>
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-modern-warning btn-sm">
                        <i class="fas fa-edit"></i> <span class="d-none d-sm-inline">Редактировать</span>
                    </a>
                    <a asp-action="Index" class="btn btn-modern-outline-secondary btn-sm">
                        <i class="fas fa-arrow-left"></i> <span class="d-none d-sm-inline">Назад</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetMaterialTypeDisplayName(MaterialType type)
    {
        return type switch
        {
            MaterialType.Document => "Документ",
            MaterialType.Presentation => "Презентация",
            MaterialType.Image => "Изображение",
            MaterialType.Audio => "Аудио",
            MaterialType.Video => "Видео",
            MaterialType.Other => "Другое",
            _ => type.ToString()
        };
    }

    private string FormatFileSize(long bytes)
    {
        string[] sizes = { "Б", "КБ", "МБ", "ГБ" };
        double len = bytes;
        int order = 0;
        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {sizes[order]}";
    }
}
