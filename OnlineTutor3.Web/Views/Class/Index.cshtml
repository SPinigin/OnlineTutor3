@model IEnumerable<OnlineTutor3.Domain.Entities.Class>
@{
    ViewData["Title"] = "Управление классами";
    var activeClasses = Model.Count(c => c.IsActive);
    var inactiveClasses = Model.Count(c => !c.IsActive);
}

<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <h4 class="mb-0 d-flex align-items-center gap-2">
        <i class="fas fa-graduation-cap text-primary"></i>
        <span>Управление классами</span>
    </h4>
    <div>
        <a asp-action="Create" class="btn btn-success">
            <i class="fas fa-plus"></i> Создать класс
        </a>
    </div>
</div>

@if (!Model.Any())
{
    <div class="text-center py-5">
        <i class="fas fa-users text-muted" style="font-size: 4rem;"></i>
        <h4 class="mt-3 text-muted">У вас пока нет классов</h4>
        <p class="text-muted">Создайте свой первый класс для начала работы с учениками</p>
        <a asp-action="Create" class="btn btn-primary">
            <i class="fas fa-plus"></i> Создать первый класс
        </a>
    </div>
}
else
{
    <div class="row mb-3 align-items-center">
        <div class="col-12 col-md-4 mb-2 mb-md-0">
            <h6 class="mb-0">
                <i class="fas fa-users"></i> 
                <span>Всего классов: @Model.Count()</span>
            </h6>
        </div>
        <div class="col-12 col-md-4 mb-2 mb-md-0">
            <div class="input-group input-group-sm">
                <span class="input-group-text bg-white">
                    <i class="fas fa-search text-muted"></i>
                </span>
                <input type="text" 
                       id="searchInput" 
                       class="form-control" 
                       placeholder="Поиск по названию..."
                       autocomplete="off">
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="btn-group btn-group-sm w-100" role="group">
                <button type="button" class="btn btn-outline-primary active" data-filter="all">
                    Все (@Model.Count())
                </button>
                <button type="button" class="btn btn-outline-success" data-filter="active">
                    Активные (@activeClasses)
                </button>
                <button type="button" class="btn btn-outline-secondary" data-filter="inactive">
                    Неактивные (@inactiveClasses)
                </button>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-striped align-middle">
            <thead class="table-light">
                <tr>
                    <th style="width: 5%;" class="text-center">
                        <i class="fas fa-check-circle"></i>
                    </th>
                    <th style="width: 30%;">Название</th>
                    <th style="width: 30%;">Описание</th>
                    <th style="width: 10%;" class="text-center">
                        Ученики
                    </th>
                    <th style="width: 10%;">Создан</th>
                    <th style="width: 15%;" class="text-center">Действия</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr class="class-row @(item.IsActive ? "" : "table-secondary")" 
                        data-status="@(item.IsActive ? "active" : "inactive")">
                        <td class="text-center">
                            <span class="badge bg-@(item.IsActive ? "success" : "secondary")">
                                <i class="fas fa-@(item.IsActive ? "check-circle" : "times-circle")"></i>
                            </span>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-graduation-cap text-primary me-2"></i>
                                <div>
                                    <strong>@item.Name</strong>
                                </div>
                            </div>
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.Description))
                            {
                                <small class="text-muted">@item.Description</small>
                            }
                            else
                            {
                                <span class="text-muted fst-italic">Описание не указано</span>
                            }
                        </td>
                        <td class="text-center">
                            <span class="badge bg-primary rounded-pill">0</span>
                        </td>
                        <td>
                            <small>
                                <i class="fas fa-calendar text-muted"></i>
                                @item.CreatedAt.ToString("dd.MM.yyyy")
                            </small>
                        </td>
                        <td class="text-center">
                            <div class="d-flex gap-1 justify-content-center">
                                <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-outline-info" title="Детали">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary" title="Редактировать">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form asp-action="ToggleActive" asp-route-id="@item.Id" method="post" class="d-inline" style="margin: 0;">
                                    <button type="submit" class="btn btn-sm btn-outline-@(item.IsActive ? "warning" : "success")" title="@(item.IsActive ? "Деактивировать" : "Активировать")">
                                        <i class="fas fa-@(item.IsActive ? "toggle-on" : "toggle-off")"></i>
                                    </button>
                                </form>
                                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger" title="Удалить">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Поиск
            $('#searchInput').on('keyup', function() {
                var value = $(this).val().toLowerCase();
                $('.class-row').filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            // Фильтр по статусу
            $('[data-filter]').on('click', function() {
                var filter = $(this).data('filter');
                $('[data-filter]').removeClass('active');
                $(this).addClass('active');
                
                $('.class-row').each(function() {
                    var status = $(this).data('status');
                    if (filter === 'all' || status === filter) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
        });
    </script>
}

